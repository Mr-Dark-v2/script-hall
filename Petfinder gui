-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- ‚úÖ Destroy old UI if re-run
local existingUI = LocalPlayer:FindFirstChild("PlayerGui"):FindFirstChild("LuxuryPetUI")
if existingUI then
    existingUI:Destroy()
end

-- ‚úÖ Safe PlayerGui reference
local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
if not playerGui then
    playerGui = Instance.new("PlayerGui")
    playerGui.Parent = LocalPlayer
end

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "LuxuryPetUI"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Panel
local mainPanel = Instance.new("Frame")
mainPanel.Name = "MovablePanel"
mainPanel.Parent = screenGui
mainPanel.AnchorPoint = Vector2.new(0.5, 0.5)
mainPanel.Position = UDim2.new(0.5, 0, 0.5, 0)
mainPanel.Size = UDim2.new(0.55, 0, 0.8, 0)
mainPanel.BackgroundTransparency = 0.25
mainPanel.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
mainPanel.BorderSizePixel = 0

-- Rounded corners
local panelCorner = Instance.new("UICorner")
panelCorner.CornerRadius = UDim.new(0, 16)
panelCorner.Parent = mainPanel

-- Draggable Implementation
local dragging = false
local dragStart = nil
local startPos = nil

mainPanel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainPanel.Position
    end
end)

mainPanel.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
        local delta = input.Position - dragStart
        mainPanel.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- ‚úÖ Divider Line ‚Äî Top fade aligns with card start (60px), bottom fade touches bottom
local dividerLine = Instance.new("Frame")
dividerLine.Name = "Divider"
dividerLine.Parent = mainPanel
dividerLine.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
dividerLine.BorderSizePixel = 0
dividerLine.AnchorPoint = Vector2.new(0.5, 1) -- Anchor to BOTTOM
dividerLine.Position = UDim2.new(0.5, 0, 1, 0) -- Bottom touches panel bottom
dividerLine.Size = UDim2.new(0, 1, 1, -60) -- Height = panel height minus 60px

local taperedEffect = Instance.new("UIGradient")
taperedEffect.Rotation = 90
taperedEffect.Transparency = NumberSequence.new({
    NumberSequenceKeypoint.new(0, 1),     -- Transparent at top of line
    NumberSequenceKeypoint.new(0.1, 0),   -- Fade in by 10% down the line
    NumberSequenceKeypoint.new(0.9, 0),   -- Stay solid
    NumberSequenceKeypoint.new(1, 1)      -- Fade out last 10% ‚Üí pointy bottom
})
taperedEffect.Parent = dividerLine

-- Mutation Color Map
local function getMutationColor(mutation)
    local colorMap = {
        Diamond = Color3.fromRGB(0, 220, 255),
        Gold = Color3.fromRGB(255, 215, 0),
        Mythic = Color3.fromRGB(255, 105, 180),
        Epic = Color3.fromRGB(180, 0, 255),
        Rare = Color3.fromRGB(0, 180, 255),
        Common = Color3.fromRGB(150, 150, 150),
    }
    return colorMap[mutation] or Color3.fromRGB(200, 200, 200)
end

-- ‚ú® LUXURY SEARCH BAR ‚Äî Integrated into main UI
local function createLuxurySearchBar(parent)
    -- Taller Search Bar ‚Äî 36px height to perfectly contain circle
    local searchBar = Instance.new("Frame")
    searchBar.Size = UDim2.new(0.45, 0, 0, 36) -- ‚úÖ Increased height
    searchBar.Position = UDim2.new(0, 15, 0, 15) -- ‚úÖ Positioned in top space
    searchBar.BackgroundTransparency = 0
    searchBar.BackgroundColor3 = Color3.fromRGB(20, 15, 25)
    searchBar.BorderSizePixel = 0
    searchBar.ZIndex = 1
    searchBar.Parent = parent

    -- Capsule shape
    local barCorner = Instance.new("UICorner")
    barCorner.CornerRadius = UDim.new(1, 0)
    barCorner.Parent = searchBar

    -- Vertical Gradient ‚Äî darkest in center
    local barGradient = Instance.new("UIGradient")
    barGradient.Rotation = 90
    barGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 20, 35)),    -- Top ‚Äî lightest
        ColorSequenceKeypoint.new(0.35, Color3.fromRGB(20, 15, 25)), -- Mid
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(18, 10, 30)),  -- CENTER ‚Äî darkest
        ColorSequenceKeypoint.new(0.65, Color3.fromRGB(20, 15, 25)), -- Mid
        ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 20, 35))     -- Bottom ‚Äî lightest
    })
    barGradient.Parent = searchBar

    -- Outlined Circle ‚Äî now 36x36 to match bar height
    local iconCircle = Instance.new("Frame")
    iconCircle.Size = UDim2.new(0, 36, 0, 36) -- ‚úÖ Match bar height
    iconCircle.Position = UDim2.new(0, 0, 0, 0) -- Flush left + top
    iconCircle.BackgroundTransparency = 0
    iconCircle.BackgroundColor3 = Color3.fromRGB(18, 10, 30)
    iconCircle.BorderSizePixel = 0
    iconCircle.ClipsDescendants = true
    iconCircle.Parent = searchBar

    -- Circle Outline
    local circleOutline = Instance.new("UIStroke")
    circleOutline.Color = Color3.fromRGB(180, 180, 180)
    circleOutline.Thickness = 1
    circleOutline.Transparency = 0.5
    circleOutline.Parent = iconCircle

    -- Circle Shape
    local circleCorner = Instance.new("UICorner")
    circleCorner.CornerRadius = UDim.new(1, 0)
    circleCorner.Parent = iconCircle

    -- üîç Emoji inside circle ‚Äî centered in 36x36
    local iconLabel = Instance.new("TextLabel")
    iconLabel.Size = UDim2.new(1, 0, 1, 0)
    iconLabel.BackgroundTransparency = 1
    iconLabel.Text = "üîç"
    iconLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    iconLabel.TextSize = 22 -- ‚úÖ Slightly larger for 36px circle
    iconLabel.Font = Enum.Font.Gotham
    iconLabel.TextXAlignment = Enum.TextXAlignment.Center
    iconLabel.TextYAlignment = Enum.TextYAlignment.Center
    iconLabel.Parent = iconCircle

    -- Placeholder Text ‚Äî adjusted position for larger circle
    local placeholder = Instance.new("TextLabel")
    placeholder.Size = UDim2.new(0.8, 0, 1, 0)
    placeholder.Position = UDim2.new(0, 44, 0, 0) -- ‚úÖ 36 + 8px padding = 44
    placeholder.BackgroundTransparency = 1
    placeholder.Text = "filter by: name ¬∑ money ¬∑ etc."
    placeholder.TextColor3 = Color3.fromRGB(180, 180, 180)
    placeholder.TextSize = 14
    placeholder.Font = Enum.Font.Gotham
    placeholder.TextXAlignment = Enum.TextXAlignment.Left
    placeholder.TextYAlignment = Enum.TextYAlignment.Center
    placeholder.TextTransparency = 0.4
    placeholder.Parent = searchBar

    -- Actual TextBox
    local textBox = Instance.new("TextBox")
    textBox.Size = UDim2.new(0.8, 0, 1, 0)
    textBox.Position = UDim2.new(0, 44, 0, 0)
    textBox.BackgroundTransparency = 1
    textBox.Text = ""
    textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    textBox.TextSize = 14
    textBox.Font = Enum.Font.Gotham
    textBox.ClearTextOnFocus = false
    textBox.Parent = searchBar

    -- Focus Outline
    local focusOutline = Instance.new("UIStroke")
    focusOutline.Color = Color3.fromRGB(255, 255, 255)
    focusOutline.Thickness = 1
    focusOutline.Transparency = 1
    focusOutline.Parent = searchBar

    -- Show/hide placeholder
    textBox.FocusLost:Connect(function(enterPressed)
        if textBox.Text == "" then
            placeholder.Visible = true
        end
        if enterPressed then
            print("üîç Searching for:", textBox.Text)
            -- üëâ Add your search logic here
        end
    end)

    textBox.Focused:Connect(function()
        placeholder.Visible = false
    end)

    -- ‚ú® HOVER + FOCUS ANIMATIONS
    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

    local originalSize = searchBar.Size
    local originalPosition = searchBar.Position
    local originalCircleColor = circleOutline.Color
    local originalCircleTransparency = circleOutline.Transparency

    local function onHoverIn()
        TweenService:Create(searchBar, tweenInfo, {
            Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset + 5, originalSize.Y.Scale, originalSize.Y.Offset),
            Position = UDim2.new(originalPosition.X.Scale, originalPosition.X.Offset - 2.5, originalPosition.Y.Scale, originalPosition.Y.Offset),
            ZIndex = 2
        }):Play()

        TweenService:Create(circleOutline, tweenInfo, {
            Color = Color3.fromRGB(220, 220, 220),
            Transparency = 0.2
        }):Play()

        TweenService:Create(iconLabel, tweenInfo, {
            TextColor3 = Color3.fromRGB(220, 220, 220)
        }):Play()
    end

    local function onHoverOut()
        if not textBox:IsFocused() then
            TweenService:Create(searchBar, tweenInfo, {
                Size = originalSize,
                Position = originalPosition,
                ZIndex = 1
            }):Play()

            TweenService:Create(circleOutline, tweenInfo, {
                Color = originalCircleColor,
                Transparency = originalCircleTransparency
            }):Play()

            TweenService:Create(iconLabel, tweenInfo, {
                TextColor3 = Color3.fromRGB(180, 180, 180)
            }):Play()

            TweenService:Create(focusOutline, tweenInfo, {
                Transparency = 1
            }):Play()
        end
    end

    local function onFocus()
        TweenService:Create(searchBar, tweenInfo, {
            Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset + 8, originalSize.Y.Scale, originalSize.Y.Offset),
            Position = UDim2.new(originalPosition.X.Scale, originalPosition.X.Offset - 4, originalPosition.Y.Scale, originalPosition.Y.Offset),
            ZIndex = 3
        }):Play()

        TweenService:Create(focusOutline, tweenInfo, {
            Transparency = 0.3
        }):Play()

        TweenService:Create(circleOutline, tweenInfo, {
            Color = Color3.fromRGB(255, 255, 255),
            Transparency = 0.3
        }):Play()

        TweenService:Create(iconLabel, tweenInfo, {
            TextColor3 = Color3.fromRGB(255, 255, 255)
        }):Play()
    end

    local function onBlur()
        TweenService:Create(searchBar, tweenInfo, {
            Size = originalSize,
            Position = originalPosition,
            ZIndex = 1
        }):Play()

        TweenService:Create(focusOutline, tweenInfo, {
            Transparency = 1
        }):Play()

        TweenService:Create(circleOutline, tweenInfo, {
            Color = originalCircleColor,
            Transparency = originalCircleTransparency
        }):Play()

        TweenService:Create(iconLabel, tweenInfo, {
            TextColor3 = Color3.fromRGB(180, 180, 180)
        }):Play()
    end

    searchBar.MouseEnter:Connect(onHoverIn)
    searchBar.MouseLeave:Connect(onHoverOut)
    textBox.Focused:Connect(onFocus)
    textBox.FocusLost:Connect(onBlur)

    return searchBar
end

-- ‚úÖ PET CARD CREATOR ‚Äî Clean, Dark Purple, No Outline, No Glow
local function createPetCard(parent, petName, mutation, statText)
    -- Resting state
    local restingSize = UDim2.new(1, 0, 0, 70)
    local restingPosition = UDim2.new(0, 0, 0, 0)

    -- Hover state ‚Äî expand 2px total (1px per side)
    local hoverSize = UDim2.new(1, 2, 0, 72)
    local hoverPosition = UDim2.new(0, -1, 0, -1)

    local card = Instance.new("Frame")
    card.Size = restingSize
    card.Position = restingPosition
    card.BackgroundTransparency = 0.3
    card.BackgroundColor3 = Color3.fromRGB(20, 15, 25) -- Dark purple base
    card.BorderSizePixel = 0
    card.Parent = parent
    card.ClipsDescendants = false
    card.ZIndex = 1

    -- Rounded corners
    local cardCorner = Instance.new("UICorner")
    cardCorner.CornerRadius = UDim.new(0, 10)
    cardCorner.Parent = card

    -- Shadow (at rest) ‚Äî subtle depth
    local shadow = Instance.new("ImageLabel")
    shadow.BackgroundTransparency = 1
    shadow.Size = UDim2.new(1, 4, 1, 4)
    shadow.Position = UDim2.new(-0.02, 0, -0.02, 0)
    shadow.Image = "rbxassetid://7203091178"
    shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
    shadow.ImageTransparency = 0.85
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 38, 38)
    shadow.ZIndex = 0
    shadow.Parent = card

    -- Inner padding
    local cardPadding = Instance.new("UIPadding")
    cardPadding.PaddingLeft = UDim.new(0, 16)
    cardPadding.PaddingRight = UDim.new(0, 16)
    cardPadding.PaddingTop = UDim.new(0, 12)
    cardPadding.PaddingBottom = UDim.new(0, 12)
    cardPadding.Parent = card

    -- Text container
    local textContainer = Instance.new("Frame")
    textContainer.Size = UDim2.new(1, 0, 1, 0)
    textContainer.Position = UDim2.new(0, 0, 0, 0)
    textContainer.BackgroundTransparency = 1
    textContainer.Parent = card

    -- PET NAME
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Parent = textContainer
    nameLabel.Size = UDim2.new(1, 0, 0, 22)
    nameLabel.Position = UDim2.new(0, 0, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = petName
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextSize = 17
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.TextYAlignment = Enum.TextYAlignment.Top

    -- MUTATION
    local mutationLabel = Instance.new("TextLabel")
    mutationLabel.Parent = textContainer
    mutationLabel.Size = UDim2.new(1, 0, 0, 14)
    mutationLabel.Position = UDim2.new(0, 0, 0, 24)
    mutationLabel.BackgroundTransparency = 1
    mutationLabel.Text = mutation
    mutationLabel.TextColor3 = getMutationColor(mutation)
    mutationLabel.TextSize = 12
    mutationLabel.Font = Enum.Font.Gotham
    mutationLabel.TextXAlignment = Enum.TextXAlignment.Left
    mutationLabel.TextTransparency = 0.6

    -- STAT (Green)
    local statLabel = Instance.new("TextLabel")
    statLabel.Parent = textContainer
    statLabel.Size = UDim2.new(1, 0, 0, 14)
    statLabel.Position = UDim2.new(0, 0, 0, 40)
    statLabel.BackgroundTransparency = 1
    statLabel.Text = statText
    statLabel.TextColor3 = Color3.fromRGB(0, 230, 100)
    statLabel.TextSize = 12
    statLabel.Font = Enum.Font.Gotham
    statLabel.TextXAlignment = Enum.TextXAlignment.Left
    statLabel.TextTransparency = 0.5

    -- Hover effects ‚Äî clean & minimal + SAFE CURSOR
    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

    local function onHoverIn()
        -- ‚úÖ Micro expansion ‚Äî feels tactile
        TweenService:Create(card, tweenInfo, {
            Size = hoverSize,
            Position = hoverPosition,
            ZIndex = 2
        }):Play()

        -- ‚úÖ Lift shadow slightly
        TweenService:Create(shadow, tweenInfo, {
            Position = UDim2.new(-0.02, 0, -0.03, 0),
            ImageTransparency = 0.8
        }):Play()

        -- ‚úÖ Brighten text
        TweenService:Create(mutationLabel, tweenInfo, {TextTransparency = 0.2}):Play()
        TweenService:Create(statLabel, tweenInfo, {TextTransparency = 0.1}):Play()

        -- ‚úÖ SAFE cursor hint
        pcall(function()
            if UserInputService.MouseIcon ~= nil then
                UserInputService.MouseIcon = "rbxasset://textures/MousePointingHand.png"
            end
        end)
    end

    local function onHoverOut()
        -- ‚úÖ Contract back
        TweenService:Create(card, tweenInfo, {
            Size = restingSize,
            Position = restingPosition,
            ZIndex = 1
        }):Play()

        -- ‚úÖ Reset shadow
        TweenService:Create(shadow, tweenInfo, {
            Position = UDim2.new(-0.02, 0, -0.02, 0),
            ImageTransparency = 0.85
        }):Play()

        -- ‚úÖ Dim text
        TweenService:Create(mutationLabel, tweenInfo, {TextTransparency = 0.6}):Play()
        TweenService:Create(statLabel, tweenInfo, {TextTransparency = 0.5}):Play()

        -- ‚úÖ SAFE reset cursor
        pcall(function()
            if UserInputService.MouseIcon ~= nil then
                UserInputService.MouseIcon = nil
            end
        end)
    end

    card.MouseEnter:Connect(onHoverIn)
    card.MouseLeave:Connect(onHoverOut)

    return card
end

-- Scrolling Area Function ‚Äî Cards start 60px from top
local function createScrollingArea(parent, xPos)
    local frame = Instance.new("ScrollingFrame")
    frame.Size = UDim2.new(0.47, 0, 1, 0)
    frame.Position = UDim2.new(xPos, xPos == 0 and 5 or 0, 0, 0)
    frame.BackgroundTransparency = 1
    frame.BorderSizePixel = 0
    frame.ScrollBarThickness = 4
    frame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 85)
    frame.CanvasSize = UDim2.new(0, 0, 0, 0)
    frame.Parent = parent

    local scrollBarCorner = Instance.new("UICorner")
    scrollBarCorner.CornerRadius = UDim.new(0, 2)
    scrollBarCorner.Parent = frame

    local scrollPadding = Instance.new("UIPadding")
    scrollPadding.PaddingLeft = UDim.new(0, 12)
    scrollPadding.PaddingRight = UDim.new(0, 12)
    scrollPadding.PaddingTop = UDim.new(0, 60) -- ‚úÖ Cards start here ‚Äî matches line‚Äôs fade-in point
    scrollPadding.PaddingBottom = UDim.new(0, 20)
    scrollPadding.Parent = frame

    local layout = Instance.new("UIListLayout")
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 10)
    layout.Parent = frame

    return frame, layout
end

local leftList, leftLayout = createScrollingArea(mainPanel, 0)
local rightList, rightLayout = createScrollingArea(mainPanel, 0.53)

-- Add Demo Cards
createPetCard(leftList, "Tralalolo Tralala", "Diamond", "1.3M/s")
createPetCard(leftList, "Shadow Pouncer", "Epic", "850K/s")
createPetCard(leftList, "Tiny Chomper", "Common", "90K/s")

createPetCard(rightList, "Cosmic Mew", "Mythic", "2.1M/s")
createPetCard(rightList, "Blaze Runner", "Diamond", "1.7M/s")
createPetCard(rightList, "Fluffy Titan", "Gold", "1.1M/s")

-- ‚úÖ ADD LUXURY SEARCH BAR TO MAIN PANEL
createLuxurySearchBar(mainPanel)

-- ‚úÖ Executor-Safe Canvas Update
spawn(function()
    wait(0.1)
    leftList.CanvasSize = UDim2.new(0, 0, 0, leftLayout.AbsoluteContentSize.Y + 40)
    rightList.CanvasSize = UDim2.new(0, 0, 0, rightLayout.AbsoluteContentSize.Y + 40)
end)
